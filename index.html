<html>
  <head>
    <title>Dinner bill splitter</title>
    <meta content="">
    <style>
        input {  margin: auto 0.5em; width: 5em; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/ractive"></script>     
    <script>
        function init() {
            var data = {
                total: 0,
                totalWithDiscount: 0,
                discountRatio: 'N/A',
                persons: [],
                sumByPersons: 0
            };
            for (var i=0; i<6; i++) {
                data.persons.push({name: i+1, total: 0, totalWithDiscount: 0});
            }
            
            var ractive = new Ractive({
                target: '#target',
                template: '#template',
                data: data
            });
            
            ractive.observe('total', recalc);
            ractive.observe('totalWithDiscount', recalc);
            ractive.observe('persons', recalc);            
            
            function recalc() { 
                var discountRatio = (data.totalWithDiscount && data.total) ? data.totalWithDiscount / data.total : 'N/A';
                for (i = 0; i < data.persons.length; i++) { 
                    var person = data.persons[i];
                    person.totalWithDiscount = (person.total && discountRatio) ? person.total * discountRatio : 'N/A';
                    data.sumByPersons += person.total;
                }    
                ractive.set('discountRatio', discountRatio);               
                ractive.set('persons', data.persons);               
                ractive.set('sumByPersons', data.sumByPersons);               
            }
        }
      
    </script>

    <script id="template" type="text/ractive">
        <div>
            <label>
                Total: <input  type="number" value='{{total}}' required min="0" step="1">
            </label>
            <label>
                Total with discount: <input type="number" value='{{totalWithDiscount}}' required min="0" step="1">
            </label>
            Discount ratio: {{discountRatio}}
        </div>
        {{#each persons}}
            <fieldset>
            <legend>Person {{name}}</legend>            
            <label>
                Total: <input  type="number" value='{{total}}' required min="0" step="1">
            </label>
            Total with discount: {{totalWithDiscount}}
            </fieldset>
        {{/each}}
        <p>Total sum by persons: {{sumByPersons}}</p>
    </script>

  </head>
  
  <body onload="init();">
    <h2>Dinner bill splitter</h2>
    <div id="target"></div>
  </body>
</html>
